android.libraryVariants.all { variant ->
  // Only attach the test jar for debug build types.
  if (variant.buildType.isDebuggable()) {
    // This will fail if we ever have multiple Debuggable build types
    project.configurations.create "testOutput"
    def jarTest = project.tasks.create "jarTest", Jar
    jarTest.classifier = 'test'
    jarTest.dependsOn variant.testVariant.javaCompile
    // Include Java classes
    jarTest.from variant.testVariant.javaCompile.destinationDir
    // todo: lookup locations from plugin API
    jarTest.from 'build/test-classes/debug'
    artifacts.add('testOutput', jarTest);
  }
}